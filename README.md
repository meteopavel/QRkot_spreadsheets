# Проект QRkot_spreadseets
Проект QRKot_spreadseets — это расширенная версия сервиса для Благотворительного фонда поддержки котиков QRkot.

Расширение базовой версии заключается в добавлении возможности формирования отчёта в гугл-таблице. В таблицу добавляются **закрытые** проекты, отсортированные по скорости сбора средств: от тех, что закрылись быстрее всего, до тех, что долго собирали нужную сумму.

## Функционал базовой версии
В Фонде QRKot может быть открыто несколько целевых проектов. У каждого проекта есть название, описание и сумма, которую планируется собрать. После того, как нужная сумма собрана — проект закрывается.

Пожертвования в проекты поступают по принципу First In, First Out: все пожертвования идут в проект, открытый раньше других; когда этот проект набирает необходимую сумму и закрывается — пожертвования начинают поступать в следующий проект.

Для управления пользователями используется библиотека FastAPI Users. Транспорт Bearer и стратегия JWT.

[Ссылка на репозиторий базовой версии](https://github.com/meteopavel/QRkot_spreadsheets/tree/main)

## Основные используемые инструменты
* python 3.9
* fastapi
* fastapi-users
* alembic
* uvicorn
* sqlalchemy
* aiogoogle
* python-dotenv

## Развёртывание проекта на локальном компьютере
1. Клонировать репозиторий и перейти в него в командной строке:
```bash
git clone git@github.com:meteopavel/QRkot_spreadsheets.git
```
2. Cоздать и активировать виртуальное окружение:
```bash
python3 -m venv venv
linux: source env/bin/activate
windows: source venv/Scripts/activate
```
3. Установить зависимости из файла requirements.txt:
```bash
python3 -m pip install --upgrade pip
pip install -r requirements.txt
```
4. Создать файл переменных окружения .env:
```bash
touch .env
```
5. Наполнить файл переменными по образцу .env.example


## Использование
1. Применить миграции:
```bash
alembic upgrade head
```

2. Запустить проект:
```bash
uvicorn app.main:app
```
Команда запустит сервер uvicorn. После этого ресурс станет доступен по
адресу http://127.0.0.1:8000.

## Пример запроса API для расширенной версии
### /google/ — POST-запрос на формирование отчёта в Google-таблице;
Пример запроса:
```json
{
  "from_reserve": "2022-05-01T00:00",
  "to_reserve": "2025-05-01T00:00",
}
```
Ожидаемый ответ:
```json
[
  {
    "meetingroom_id": 1,
    "count": 1
  },
  {
    "meetingroom_id": 2,
    "count": 1
  },
  {
    "meetingroom_id": 3,
    "count": 1
  }
]
```
Сформированная Google-таблица станет доступна на вашем личном аккаунте.

## Примеры некоторых запросов API для базового функционала
### /donation/ — POST-запрос на создание нового пожертвования;
Пример запроса:
```json
{
  "full_amount": 0,
  "comment": "string"
}
```
Ожидаемый ответ:
```json
{
  "full_amount": 0,
  "comment": "string",
  "id": 0,
  "create_date": "2019-08-24T14:15:22Z"
}
```

### /users/me — GET-запрос на получение информации о текущем пользователе.
Ожидаемый ответ:
```json
{
  "id": null,
  "email": "user@example.com",
  "is_active": true,
  "is_superuser": false,
  "is_verified": false
}
```

3. Полная документация Swagger доступна по адресу:
http://127.0.0.1:8000/swagger

4. Полная документация ReDoc доступна по адресу:
http://127.0.0.1:8000/redoc


## Автор
[Павел Найденов](https://github.com/meteopavel)